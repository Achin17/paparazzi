<!DOCTYPE module SYSTEM "module.dtd">

<module name="guidance_delftacopter" dir="guidance">
  <doc>
    <description>
      Guidance controller for the Delftacopter hybrid vehicle
    </description>
    <define name="DC_HOVER_THROTTLE_CURVE" value="1" description="Throttle curve to use for hover flights"/>
    <define name="DC_FORWARD_THROTTLE_CURVE" value="2" description="Throttle curve to use for forward flights"/>
    <define name="DC_FORWARD_MAX_AIRSPEED" description="Forward maximum airspeed the platform can reach"/>
    <define name="DC_FORWARD_NOMINAL_THRUST" description="Forward nominal thrust value"/>
    <define name="DC_FORWARD_VERTICAL_PGAIN" description="Forward flight vertical P gain"/>
    <define name="DC_FORWARD_VERTICAL_DGAIN" description="Forward flight vertical D gain"/>
    <define name="DC_FORWARD_VERTICAL_LOW_AIRSPEED" description="Forward flight vertical patch low airspeed"/>
    <define name="DC_FORWARD_VERTICAL_LOW_AIRSPEED_PITCH_GAIN" description="Forward flight vertical pitch gain when in lowe airspeeds"/>
    <define name="DC_FORWARD_MAX_TURN_BANK" description="Forward flight maximum turn banking"/>
    <define name="DC_FORWARD_TURN_BANK_GAIN" description="Forward flight turn bank gain"/>
    <define name="DC_FORWARD_PITCH_OF_ROLL" description="Forward pitch up from roll gain"/>
    <define name="DC_FORWARD_THROTTLE_FROM_PITCH_UP" description="Forward throttle from pitch up gain"/>
    <define name="DC_FORWARD_MIN_PITCH" description="Forward minimum pitch value"/>
    <define name="DC_FORWARD_MAX_PITCH" description="Forward minimum pitch value"/>
    <define name="DC_TRANSITION_THROTTLE_TO_FORWARD" description="Throttle during transition to forward"/>
    <define name="DC_TRANSITION_THROTTLE_TO_HOVER" description="Throttle during transition to hover"/>
    <define name="DC_FORWARD_MAX_PSI" description="Maximum psi offset from measured psi in forward"/>
    <define name="DC_FORWARD_K_FF_TO_YAW" description="Feed forward gain of yaw command from desired yaw-rate in forward"/>
  </doc>
  <settings>
    <dl_settings>
      <dl_settings NAME="Hybrid Guidance">
        <dl_setting var="max_airspeed" min="5" step="0.5" max="45" param="DC_FORWARD_MAX_AIRSPEED"/>
        <dl_setting var="nominal_forward_thrust" min="0" step="50" max="9600" param="DC_FORWARD_NOMINAL_THRUST"/>
        <dl_setting var="vertical_pgain" min="0.0" step="0.001" max="1.0" param="DC_FORWARD_VERTICAL_PGAIN"/>
        <dl_setting var="vertical_dgain" min="0.0" step="0.001" max="1.0" param="DC_FORWARD_VERTICAL_DGAIN"/>
        <dl_setting var="low_airspeed_pitch_gain" min="0.0" step="0.1" max="5.0" param="DC_FORWARD_VERTICAL_LOW_AIRSPEED_PITCH_GAIN"/>
        <dl_setting var="max_turn_bank" min="10.0" step="1.0" max="60.0" param="DC_FORWARD_MAX_TURN_BANK"/>
        <dl_setting var="turn_bank_gain" min="0.1" step="0.01" max="3.0" param="DC_FORWARD_TURN_BANK_GAIN"/>
        <dl_setting var="vertical_pitch_of_roll" min="0.0" step="0.01" max="0.25" param="DC_FORWARD_PITCH_OF_ROLL"/>
        <dl_setting var="throttle_from_pitch_up" min="0.0" step="1.0" max="500.0" param="DC_FORWARD_THROTTLE_FROM_PITCH_UP"/>
        <dl_setting var="transition_throttle_to_forward" min="3200" step="1" max="9600" param="DC_TRANSITION_THROTTLE_TO_FORWARD"/>
        <dl_setting var="transition_throttle_to_hover" min="3200" step="1" max="9600" param="DC_TRANSITION_THROTTLE_TO_HOVER"/>
        <dl_setting var="forward_max_psi" shortname="fwd_max_psi" min="0.0" step="0.5" max="30.0" param="DC_FORWARD_MAX_PSI"/>
        <dl_setting var="acc_y_filter_cutoff_hz" shortname="slip_fiter_cutoff_hz" min="0.0" max="10" step="0.001" param="DC_FORWARD_ACC_Y_FILTER_CUTOFF_HZ" type="float" handler="set_acc_y_cutoff_hz" module="guidance/guidance_delftacopter"/>
        <dl_setting var="feedforward_yaw_of_turn_rate" shortname="ff_yaw_of_turnr" min="0.0" max="3000.0" step="1" param="DC_FORWARD_K_FF_TO_YAW"/>
        <dl_setting var="e_psi_deg_from_acc_y" shortname="ff_yaw_of_yacc" min="-50" max="50" step="0.01" param="DC_FORWARD_E_PSI_DEG_FROM_ACC_Y" type="float"/>
        <!-- Unknown... -->
        <dl_setting var="perpen_dgain" min="0.0" step="0.01" max="360.0" shortname="perpen_dgain"/>       
      </dl_settings>
      <dl_settings NAME="FWD">
        <dl_setting var="delftacopter_fwd_roll_pgain" shortname="roll_pgain" min="0" step="0.01" max="10000" param="DC_FORWARD_ROLL_PGAIN"/>
        <dl_setting var="delftacopter_fwd_roll_dgain" shortname="roll_dgain" min="0" step="0.01" max="5000" param="DC_FORWARD_ROLL_DGAIN"/>
        <dl_setting var="delftacopter_fwd_roll_igain" shortname="roll_igain" min="0" step="0.01" max="10000" param="DC_FORWARD_ROLL_IGAIN"/>
        <dl_setting var="delftacopter_fwd_roll_trim" shortname="roll_trim" min="0" step="0.01" max="10000" param="DC_FORWARD_ROLL_TRIM"/>
        <dl_setting var="delftacopter_fwd_pitch_pgain" shortname="pitch_pgain" min="0" step="0.01" max="10000" param="DC_FORWARD_PITCH_PGAIN"/>
        <dl_setting var="delftacopter_fwd_pitch_dgain" shortname="pitch_dgain" min="0" step="0.01" max="5000" param="DC_FORWARD_PITCH_DGAIN"/>
        <dl_setting var="delftacopter_fwd_pitch_igain" shortname="pitch_igain" min="0" step="0.01" max="1000" param="DC_FORWARD_PITCH_IGAIN"/>
        <dl_setting var="delftacopter_fwd_pitch_trim" shortname="pitch_trim" min="0" step="0.01" max="1000" param="DC_FORWARD_PITCH_TRIM"/>
        <dl_setting var="feedforward_yaw_of_turn_rate" shortname="yaw_of_turnr" min="0" step="0.01" max="5000" param="DC_FORWARD_K_FF_TO_YAW"/>
        <dl_setting var="delftacopter_fwd_advance_angle_p" shortname="adv_p" min="-1.6" step="0.005" max="1.6" param="DC_FORWARD_ADVANCE_P"/>
        <dl_setting var="delftacopter_fwd_advance_angle_q" shortname="adv_q" min="-1.6" step="0.005" max="1.6" param="DC_FORWARD_ADVANCE_Q"/>
        <dl_setting var="delftacopter_fwd_pitch_swp" shortname="pitch_swp" min="0" step="0.01" max="1" param="DC_FORWARD_PITCH_SWP"/>
      </dl_settings>
    </dl_settings>
  </settings>
  <header>
    <file name="guidance_delftacopter.h"/>
  </header>
  <init fun="guidance_hybrid_init()"/>
  <makefile target="ap|nps" firmware="rotorcraft">
    <file name="guidance_delftacopter.c" dir="$(SRC_FIRMWARE)/guidance"/>
    <define name="HYBRID_NAVIGATION" value="TRUE"/>
    <define name="USE_GUIDANCE_DELFTACOPTER" value="TRUE"/>
  </makefile>
</module>
