<!-- this is a 'DelFly Sherlok' frame equiped with Lisa/S 1.0 -->

<!--
     Applicable configuration:
     airframe="airframes/TUDELFT/tudelft_delfly_sherlok.xml"
     radio="radios/cockpitSX.xml"
     telemetry="telemetry/default_rotorcraft.xml" / telemetry="telemetry/rotorcraft_with_logger.xml"
     flight_plan="flight_plans/rotorcraft_basic.xml"
     settings="settings/rotorcraft_basic.xml settings/control/rotorcraft_guidance.xml settings/control/stabilization_att_int.xml settings/persistent_settings.xml"
-->

<airframe name="delfly_sherlok">
	
	<!-- FIRMWARE %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->

  <firmware name="rotorcraft">
	  <target name="ap" board="lisa_s_1.0">
		  <module name="radio_control" type="superbitrf_rc">
			  <define name="RADIO_KILL_SWITCH" value="6"/>
			  <!--define name="RADIO_MODE" value="RADIO_AUX2"/-->
		  </module>
		
		  <!-- Comment the above line and uncomment the block below if DelTang is used instead
			  of SuperbitRF -->
		  <!--module name="radio_control" type="ppm">
			  <configure name="RADIO_CONTROL_PPM_PIN" value="SERVO6"/>
			  <define name="RADIO_KILL_SWITCH" value="RADIO_GEAR"/>
        		<define name="RADIO_YAW" value="RADIO_ROLL"/>
        	</module-->
		
		  <configure name="USE_MAGNETOMETER" value="0"/>
		  <configure name="AHRS_PROPAGATE_FREQUENCY" value="500"/>
		  <define name="LOW_NOISE_TIME" value="50"/> <!--Set the time of the ahrs alignement, 1 = 100 samples = 0.2s at 500 Hz -->
		  <define name="USE_PERSISTENT_SETTINGS" value="TRUE"/>
		
		  <define name="USE_BARO_BOARD" value="1"/>
		  <define name="BARO_PERIODIC_FREQUENCY" value="100"/>
		  <define name="USE_ATTITUDE_REF" value="0"/> <!-- disable reference model, directly use setpoint-->
		  <define name="AHRS_ALIGNER_LED" value="2"/>
	  </target>
	
	  <!-- Necessary to build succesfully, but not used -->
	  <module name="motor_mixing"/>
	
	  <module name="actuators" type="pwm">
		  <define name="SERVO_HZ" value="200"/>
		  <define name="USE_SERVOS_1AND2"/>
	  </module>
	
	  <!-- TELEMETRY -->
	  <module name="telemetry" type="superbitrf"/>
	  <!-- Comment the previous line and uncomment the following block if you need to use
		  the debug serial interface for telemetry. -->
  <!--		<module name="telemetry" type="transparent">-->
  <!--			<configure name="MODEM_BAUD" value="B57600"/>-->
  <!--			<configure name="MODEM_PORT" value="UART1"/>-->
  <!--		</module>-->
	
	  <module name="imu" type="lisa_s_v1.0"/>
	  <module name="gps" type="datalink"/>
	  <module name="stabilization" type="int_euler">
		  <define name="STABILIZATION_ATTITUDE_SP_PSI_DELTA_LIMIT" value="90" unit="deg"/>
	  </module>
	  <module name="ahrs" type="int_cmpl_quat">
		  <define name="AHRS_PROPAGATE_LOW_PASS_RATES" value="TRUE"/>
	  </module>
	  <module name="ins" type="hff">
		  <!-- Check what is this setting? -->
  <!--			<define name="INS_INT_GPS_ID" value="ABI_DISABLE"/-->
	  </module>
  </firmware>
  
    <!-- MODULES %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->

  <modules main_freq="512">
	  <module name="send_imu_mag_current"/>
	
	  <module name="stereocam">
		  <configure name="STEREO_UART" value="UART1"/>
		  <configure name="STEREO_BAUD" value="B921600"/>
		  <define name="SEND_STEREO" value="FALSE"/>
	  </module>
  <!--		<module name="stereocam_state2camera"-->
  <!--			<configure name="STEREO_UART" value="UART1"/>-->
  <!--			<configure name="STEREO_BAUD" value="B115200"/>-->
  <!--		</module-->
	  <module name="stereocam_stereocam2state"/>
	  <module name="droplet"/>
  </modules>
    
	<!-- ACTUATORS & COMMANDS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
	<servos driver="Pwm">
		<servo name="MOTOR" no="4" min="1100" neutral="1100" max="1900"/>
		<servo name="ELEVATOR" no="0" min="1700" neutral="1500" max="1300"/>
		<servo name="AILERON" no="5" min="1700" neutral="1500" max="1300"/>
	</servos>
	
	<!-- SETTINGS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
	<section name="IMU" prefix="IMU_">
		<define name="BODY_TO_IMU_PHI" value="-60." unit="deg"/> <!-- Roll: true angle 0, -50 added for default pitch up of delfly -->
  	<define name="BODY_TO_IMU_THETA" value="0." unit="deg"/> <!-- Pitch -->
		<define name="BODY_TO_IMU_PSI" value="-90." unit="deg"/> <!-- Yaw -->
	</section>
	
	<include href="conf/airframes/TUDELFT/tudelft_delfly_the_investigator.xml"/>
</airframe>
